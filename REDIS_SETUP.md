# Настройка Redis для мгновенного обновления домена

## Что изменилось

Теперь домен хранится в **Redis** вместо файлов. Это позволяет обновлять домен мгновенно без пересборки проекта!

## Настройка Redis

### Вариант 1: Использовать REDIS_URL (рекомендуется)

Добавьте переменную окружения в Vercel:

1. Зайдите в проект на Vercel
2. Перейдите в **Settings** → **Environment Variables**
3. Добавьте новую переменную:
   - **Key:** `REDIS_URL`
   - **Value:** `redis://[:password@]host[:port][/db-number]`
   - **Environment:** Production, Preview, Development

**Примеры форматов:**
- `redis://localhost:6379` (без пароля)
- `redis://:password@host:6379` (с паролем)
- `redis://:password@host:6379/0` (с паролем и номером БД)
- `rediss://:password@host:6380` (SSL соединение)

### Вариант 2: Использовать отдельные параметры

Если у вас нет единого URL, используйте отдельные переменные:

- `REDIS_HOST` - хост Redis сервера
- `REDIS_PORT` - порт (по умолчанию 6379)
- `REDIS_PASSWORD` - пароль (если требуется)

## Бесплатные Redis сервисы

### Upstash Redis (рекомендуется для Vercel)

1. Зайдите на https://upstash.com/
2. Создайте аккаунт (бесплатный план доступен)
3. Создайте новую Redis базу данных
4. Скопируйте **REST URL** - это ваш `REDIS_URL`
5. Добавьте его в переменные окружения Vercel как `REDIS_URL`

**Преимущества:**
- ✅ Бесплатный план доступен
- ✅ Отлично работает с Vercel
- ✅ Автоматическое масштабирование
- ✅ Глобальное распределение

### Другие варианты:

- **Redis Cloud** - https://redis.com/try-free/
- **Railway** - https://railway.app/ (можно развернуть свой Redis)
- **Ваш собственный Redis сервер**

## Установка зависимостей

Убедитесь, что установлен пакет `ioredis`:

```bash
npm install
```

или

```bash
pnpm install
```

## Пересборка проекта

После добавления переменных окружения пересоберите проект один раз:

- В Vercel: Deployments → ... → Redeploy
- Или сделайте новый коммит и пуш

## Как это работает

1. **Хранение:** Домен хранится в Redis - быстром хранилище
2. **Чтение:** При каждом запросе домен читается из Redis
3. **Обновление:** При команде `/changedomain` домен обновляется в Redis мгновенно
4. **Без пересборки:** Изменения применяются сразу, без пересборки проекта!

## Использование

После настройки просто отправьте боту:

```
/changedomain createsync.click
```

Домен изменится **мгновенно** и будет доступен сразу же!

## Проверка

Проверьте текущий домен:

```
/domain
```

## Важно!

- ✅ Redis должен быть доступен из интернета (для Vercel)
- ✅ Переменная окружения `REDIS_URL` (или `REDIS_HOST`) должна быть установлена
- ✅ После первой настройки нужно пересобрать проект один раз
- ✅ После этого все изменения применяются мгновенно без пересборки!

## Fallback

Если Redis недоступен, система использует:
1. Переменную окружения `VERIFICATION_DOMAIN` (если установлена)
2. Значение по умолчанию `createsync.help`

Это обеспечивает надежность работы даже если Redis временно недоступен.

## Troubleshooting

### Ошибка "Redis not configured"

Убедитесь что установлена переменная `REDIS_URL` или `REDIS_HOST` в Vercel.

### Ошибка подключения к Redis

1. Проверьте что Redis доступен из интернета
2. Проверьте правильность URL/хоста/порта
3. Проверьте пароль (если требуется)
4. Для Upstash используйте REST URL, не WebSocket URL

### Домен не обновляется

1. Проверьте логи в Vercel - там будет видно ошибки Redis
2. Убедитесь что Redis доступен
3. Попробуйте подключиться к Redis вручную для проверки
